# GitHub Telegram Bot

Telegram бот для отслеживания событий GitHub репозиториев с поддержкой webhooks и polling.

## Возможности

- ✅ Отслеживание коммитов
- ✅ Отслеживание звезд (stars)
- ✅ Отслеживание форков
- ✅ Отслеживание Issues (создание, закрытие, открытие, переоткрытие, блокировка, разблокировка)
- ✅ Отслеживание комментариев к Issues (создание, удаление)
- ✅ Отслеживание Pull Requests (создание, закрытие, открытие, переоткрытие, блокировка, разблокировка, синхронизация)
- ✅ Отслеживание комментариев к Pull Requests (создание, удаление)
- ✅ Отслеживание релизов (публикация, выпуск)
- ✅ Настройка событий через inline меню
- ✅ Статистика по репозиториям
- ✅ Поддержка приватных репозиториев
- ✅ Режимы работы: webhook и polling

## Установка

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd github-tg-bot
```

2. Установите зависимости через `uv`:
```bash
uv sync
```

3. Создайте файл `.env` на основе `.env.example`:
```bash
cp .env.example .env
```

4. Заполните переменные окружения в `.env`:
```env
BOT_TOKEN=your_telegram_bot_token
GITHUB_TOKEN=your_github_token  # Опционально, для приватных репозиториев
# Можно указать несколько токенов через запятую или точку с запятой для автоматического переключения:
# GITHUB_TOKEN=token1,token2,token3
# или
# GITHUB_TOKEN=token1;token2;token3
MODE=polling  # или webhook
WEBHOOK_URL=https://yourdomain.com  # Только для webhook
WEBHOOK_SECRET=your_webhook_secret  # Только для webhook
WEBHOOK_PATH=/webhook  # Только для webhook
POLLING_INTERVAL=60  # Интервал проверки в секундах (только для polling)
```

**Примечание о rate limit:**
- Rate limit в GitHub API привязан к токену, а не к аккаунту
- Если токены принадлежат одному аккаунту, они могут иметь общий лимит
- Если токены разных аккаунтов - у каждого свой лимит (5000 запросов/час с токеном, 60 без токена)
- При исчерпании rate limit бот автоматически переключится на следующий доступный токен
- При исчерпании всех токенов бот отправит уведомление с информацией о времени сброса лимита

## Запуск

### Режим Polling

Установите `MODE=polling` в `.env` и запустите:
```bash
uv run python -m bot.main
```

### Режим Webhook

1. Установите `MODE=webhook` в `.env`
2. Настройте переменные `WEBHOOK_URL`, `WEBHOOK_SECRET`, `WEBHOOK_PATH`
3. Запустите бота:
```bash
uv run python -m bot.main
```

4. Настройте webhook в GitHub:
   - Перейдите в настройки репозитория
   - Выберите "Webhooks" → "Add webhook"
   - URL: `https://yourdomain.com/webhook`
   - Content type: `application/json`
   - Secret: ваш `WEBHOOK_SECRET`
   - События: выберите нужные события

## Использование

### Команды бота

- `/start` - Запустить бота и увидеть справку
- `/add <owner/repo>` - Добавить репозиторий для отслеживания
- `/remove <owner/repo>` - Удалить репозиторий из отслеживания
- `/list` - Показать список отслеживаемых репозиториев
- `/stats` - Показать статистику по всем репозиториям
- `/settings <owner/repo>` - Открыть настройки репозитория

### Добавление репозитория

Вы можете добавить репозиторий несколькими способами:

1. Через команду:
```
/add microsoft/vscode
```

2. Через ссылку в сообщении:
```
https://github.com/microsoft/vscode
```

### Настройка событий

1. Используйте команду `/settings <owner/repo>`
2. Выберите события для отслеживания через inline кнопки
3. По умолчанию все события отключены

### Статистика

Используйте команду `/stats` для просмотра статистики по всем репозиториям:
- Количество звезд
- Количество форков
- Количество issues (открытые/закрытые)
- Количество pull requests (открытые/закрытые)
- Список контрибьюторов
- Языки программирования

## Структура проекта

```
github-tg-bot/
├── bot/
│   ├── main.py              # Точка входа
│   ├── handlers/            # Обработчики команд и сообщений
│   ├── services/            # Сервисы (GitHub API, база данных, форматирование)
│   ├── keyboards/           # Inline клавиатуры
│   └── models/              # Модели данных
├── data/
│   └── database.json        # JSON база данных
├── .env                     # Переменные окружения (не в git)
├── .env.example             # Пример конфигурации
├── pyproject.toml           # Зависимости проекта
└── README.md                # Этот файл
```

## Настройка webhook для GitHub

Если вы используете режим webhook, вам нужно настроить webhook в GitHub:

1. Перейдите в настройки репозитория → Webhooks
2. Нажмите "Add webhook"
3. Заполните:
   - **Payload URL**: `https://yourdomain.com/webhook`
   - **Content type**: `application/json`
   - **Secret**: ваш `WEBHOOK_SECRET`
   - **Events**: выберите события, которые хотите отслеживать

## Приватные репозитории

Для отслеживания приватных репозиториев:

1. Создайте GitHub Personal Access Token с правами `repo`
2. Установите `GITHUB_TOKEN` в `.env`
3. Бот будет использовать этот токен для доступа к приватным репозиториям

## Разработка

### Зависимости

Проект использует:
- `aiogram` - асинхронный фреймворк для Telegram ботов
- `aiohttp` - асинхронный HTTP клиент
- `aiofiles` - асинхронная работа с файлами
- `python-dotenv` - загрузка переменных окружения

### Логирование

Все логи выводятся в консоль с уровнем INFO. Для отладки можно изменить уровень на DEBUG в `main.py`.
